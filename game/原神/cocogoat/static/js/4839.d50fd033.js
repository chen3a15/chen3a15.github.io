"use strict";(self["define"]=self["define"]||[]).push([[4839],{43059:function(e,t,o){o.r(t),o.d(t,{default:function(){return C}});var n=o(15471),a=(o(30896),o(29056)),s=(o(60388),o(10311));const c=(0,s.createElementVNode)("span",{style:{"font-family":"genshin"}},"椰羊 · ",-1),l=["src"],r={class:"model"},i=(0,s.createElementVNode)("div",{class:"title"},"扫描完成",-1),m={key:0,class:"faildResults"},d=["src"],u=["value"],f={class:"operations"},p={key:1},v=(0,s.createElementVNode)("a",null," | ",-1);function h(e,t,o,h,g,y){const E=a.mi,k=n.Q0,S=(0,s.resolveComponent)("Layout");return(0,s.openBlock)(),(0,s.createBlock)(S,{"full-height":""},{title:(0,s.withCtx)((()=>[c,(0,s.createTextVNode)("扫描成就并导出到 "+(0,s.toDisplayString)("seelie"===e.to?"SEELIE.me":"Paimon.moe"),1)])),actions:(0,s.withCtx)((()=>[(0,s.createVNode)(k,{content:"扫描完成之后也还可以切换哦"},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(E,{class:"switch",type:"primary",plain:"",onClick:t[0]||(t[0]=t=>e.$router.replace({...e.$route,query:{...e.$route.query,to:"seelie"===e.to?"paimon-moe":"seelie"}}))},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)(" 切换到 "+(0,s.toDisplayString)("seelie"===e.to?"Paimon.moe":"SEELIE.me"),1)])),_:1})])),_:1})])),default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("iframe",{ref:"contentFrame",class:(0,s.normalizeClass)(e.$style.fr),src:e.frameUrl,frameborder:"0"},null,10,l),e.finished?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:(0,s.normalizeClass)(e.$style.modelBackdrop)},[(0,s.createElementVNode)("div",r,[i,e.showFaildImages?((0,s.openBlock)(),(0,s.createElementBlock)("div",m,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.faildResults,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("img",{key:t,src:e},null,8,d)))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)("textarea",{key:1,value:"seelie"===e.to?e.exportToSeelie:e.exportToPaiminMoe},null,8,u)),(0,s.createElementVNode)("div",f,[e.faildResults.length>0?((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:0,onClick:t[1]||(t[1]=t=>e.showFaildImages=!e.showFaildImages)},(0,s.toDisplayString)(e.showFaildImages?"返回导出结果":"查看失败项"),1)):(0,s.createCommentVNode)("",!0),e.faildResults.length>0?((0,s.openBlock)(),(0,s.createElementBlock)("a",p," | ")):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("span",{class:"switch",onClick:t[2]||(t[2]=t=>e.$router.replace({...e.$route,query:{...e.$route.query,to:"seelie"===e.to?"paimon-moe":"seelie"}}))},"切换到 "+(0,s.toDisplayString)("seelie"===e.to?"Paimon.moe":"SEELIE.me"),1),v,(0,s.createElementVNode)("span",{class:"reset",onClick:t[3]||(t[3]=(...t)=>e.reset&&e.reset(...t))},"重新开始")])])],2)):(0,s.createCommentVNode)("",!0)])),_:1})}o(43928);var g=o(48243),y=o(20811),E=o(15748),k=(0,s.defineComponent)({setup(){const e=(0,y.G)("frames.achievement.scan"),t=(0,s.ref)(!1),o=(0,s.ref)(!1),n=(0,s.ref)([]),a=(0,s.computed)((()=>n.value.filter((e=>!e.success||!e.done)).map((e=>{var t;return null===(t=e.images)||void 0===t?void 0:t.main})))),c=(0,s.ref)(null),l=(0,g.useRoute)(),r=(0,s.computed)((()=>"seelie"===l.query.to?"seelie":"paimon-moe"));(0,s.watch)(c,(e=>{e&&window.addEventListener("message",(e=>{const{app:t,event:a,data:s}=e.data;if("cocogoat.scanner.achievement"===t)if("ready"!==a){if("result"===a){const{result:e}=s;for(const t of e)if(t.success&&t.achievement.preStage&&t.achievement.preStage>0){const o=E["default"].find((e=>e.id===t.achievement.categoryId));if(o){const n=o.achievements.find((e=>e.id===t.achievement.preStage));if(n){const o={...t,success:!0};e.push({...o,achievement:{...n,categoryId:t.achievement.categoryId}})}}}n.value=e,o.value=!0,console.log("got result from scanner")}}else o.value=!1}))}));const i=(0,s.computed)((()=>{const e=n.value.filter((e=>e.success&&e.date)).map((e=>{const t=e.achievement;return[t.categoryId,t.id]}));return`/* \n* 复制此处所有内容，\n* 在 Paimon.moe 页面按 F12 打开调试器，\n* 选择控制台（Console）\n* 粘贴并回车执行完成导入\n*/\nconst b = ${JSON.stringify(e)};\nconst a = (await localforage.getItem('achievement')) || {};\nb.forEach(c=>{a[c[0]]=a[c[0]]||{};a[c[0]][c[1]]=true})\nawait localforage.setItem('achievement',a);\nlocation.href='/achievement'`})),m=(0,s.computed)((()=>{const e=n.value.filter((e=>e.success&&e.date)).map((e=>{const t=e,o=t.achievement;return[o.id,(t.status+" "+t.date).trim()]}));return`/* \n* 复制此处所有内容，\n* 在 SEELIE.me 页面按 F12 打开调试器，\n* 选择控制台（Console）\n* 粘贴并回车执行完成导入\n*/\nconst z = ${JSON.stringify(e)};\nconst a = localStorage.account || 'main'\nconst b = JSON.parse(localStorage.getItem(\`\${a}-achievements\`)||'{}')\nz.forEach(c=>{b[c[0]]={done:true,notes:c[1]}})\nlocalStorage.setItem(\`\${a}-achievements\`,JSON.stringify(b))\nlocalStorage.last_update = (new Date()).toISOString()\nlocation.href='/achievements'`})),d=()=>{var e,t;null===(e=c.value)||void 0===e||null===(t=e.contentWindow)||void 0===t||t.postMessage({app:"cocogoat.scanner.achievement",event:"reset"},"*")};return{finished:o,results:n,exportToPaiminMoe:i,exportToSeelie:m,contentFrame:c,reset:d,faildResults:a,showFaildImages:t,to:r,frameUrl:e}}}),S={fr:"fr-e4616f",modelBackdrop:"model-backdrop-c93930"},w=o(14545);const N={};N["$style"]=S;const B=(0,w.Z)(k,[["render",h],["__cssModules",N]]);var C=B},30896:function(e,t,o){o(30057)},30057:function(e,t,o){o(75452),o(26238)}}]);