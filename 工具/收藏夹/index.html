<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="data.js"></script>
    <style>
        
        div {
            border: 1px dashed #D0E0E0;
            color: #90BEDE;
            font-size: calc(1.4vh + 0.9vw);
            position: absolute;
            left: 5%;
            right: 5%;
            max-width: 90%;
        }
        
        input {
            font-size: 100%;
            width: 100%;
        }
        
        th, td {
            border: 1px dashed #D0E0E0;
        }
        
        a {
            text-decoration: none;
            /* 取消下划线 */
        }
        
    </style>
    <title>收藏夹</title>
  </head>
  <body onload="list()">
    <div>
        <form onsubmit="list(); return false">
            <input id="search" oninput="asearch()" type="search" value="" />
        </form>
        <table id="table"></table>
    </div>
    <script>
        var timer;
        
        function asearch() {
            if (timer) clearTimeout(timer);
            timer = setTimeout(list, 2000);
        }
        
        function list(){
            let table = document.getElementById("table");
            let search = document.getElementById("search").value.toUpperCase().split(" ");
            while (table.childNodes.length > 0){
                table.removeChild(table.childNodes[0]);
            }
            let th = document.createElement("tr");
            th.innerHTML = "<tr><th>链接</th><th>标签</th></tr>"
            table.appendChild(th);
            for (let i in data){
                if (data[i] === ""){continue}
                let asdf = false
                for (let j in search){
                    if (data[i].toUpperCase().indexOf(search[j]) === -1){
                        asdf = true
                    }
                }
                if (asdf){continue}
                let d = {}
                try {
                    d = JSON.parse(data[i]);
                } catch (err){
                    console.error("data第" + (parseInt(i) + 1).toString() + "行解析错误：" + data[i])
                }
                let tr = document.createElement("tr");
                table.appendChild(tr);
                let link = document.createElement("td");
                tr.appendChild(link);
                let link_a = document.createElement("a");
                if (d.hasOwnProperty("link")){
                    link_a.href = d["link"];
                    if (d.hasOwnProperty("title") && d["title"] != ""){
                        link_a.innerHTML = d["title"];
                    } else {
                        link_a.innerHTML = d["link"];
                    }
                } else {
                    link_a.innerHTML = "<span style='color: red'>data第" + (parseInt(i) + 1).toString() + "行解析错误：" + data[i] + "</span>";
                    console.error("data第" + (parseInt(i) + 1).toString() + "行解析错误：" + data[i])
                }
                link_a.target = "_blank";
                link.appendChild(link_a);
                if (d.hasOwnProperty("tags")){
                    let tags = document.createElement("td");
                    tr.appendChild(tags);
                    let splits = document.createElement("span");
                    for (let j in d["tags"]){
                        tags.appendChild(splits);
                        let tag = document.createElement("span");
                        tag.innerHTML = d["tags"][j];
                        tag.setAttribute("onclick", "document.getElementById('search').value = '" + tag.innerHTML + "'; list()")
                        tags.appendChild(tag);
                        splits = document.createElement("span");
                        splits.innerHTML = "、";
                    }
                }
            }
            if (document.getElementById("search").value === ""){
                document.getElementById("search").value = "搜索关键字";
            }
        }
    </script>
    </body>
</html>